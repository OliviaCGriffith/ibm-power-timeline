<!-- Fixed: Clean IBM Power Timeline — full working canvas (syntax errors resolved) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IBM Power Timeline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.11.0/dist/pptxgen.bundle.js"></script>

  <!-- Timeline background JSON holder (multi-chunk safe). Fill the PARTs with your base64 chunks. -->
  <script id="timeline-bg-json" type="application/json">{"TIMELINE_BG_PART1":"","TIMELINE_BG_PART2":"","TIMELINE_BG_PART3":"","TIMELINE_BG_PART4":"","TIMELINE_BG_PART5":""}</script>
</head>
<body class="bg-gray-50">
<div id="root"></div>

<script type="text/babel">
const { useState } = React;

// Build full base64 data URL from JSON parts
const getTimelineBgData = () => {
  try {
    const el = document.getElementById('timeline-bg-json');
    if (!el) return null;
    const json = JSON.parse(el.textContent || '{}');
    const parts = [json.TIMELINE_BG_PART1||'', json.TIMELINE_BG_PART2||'', json.TIMELINE_BG_PART3||'', json.TIMELINE_BG_PART4||'', json.TIMELINE_BG_PART5||''];
    const base = parts.join('');
    return base ? 'data:image/png;base64,' + base : null;
  } catch (e) {
    console.error('Failed to read timeline-bg-json', e);
    return null;
  }
};

// Utilities
const parseDateLocal = (s) => { if (!s) return null; const [y,m,d] = s.split('-').map(Number); return new Date(y, m-1, d); };
const addDays = (d, n) => { const r = new Date(d); r.setDate(r.getDate()+n); return r; };
const addWeeks = (d, w) => addDays(d, w*7);
const calcWeeks = (n) => { const c = Number(n)||0; if (c===0) return 0; if (c<=10) return 1; if (c<=20) return 2; return 3; };
const fmt = (d) => (d instanceof Date ? d.toLocaleDateString() : '');

function IBMWizard(){
  const [step, setStep] = useState(1);
  const [mode, setMode] = useState(null); // 'po' or 'end'
  const [form, setForm] = useState({ poDate:'', endMigrationDate:'', s1022:0, s1024:0, e1050:0, e1080:0, lpars:0 });
  const [timeline, setTimeline] = useState(null);
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const { name, value, type } = e.target;
    setForm(prev => ({ ...prev, [name]: (type==='range' || type==='number') ? Number(value) : value }));
  };

  const validate = () => {
    if (!mode) { setError('Choose PO Received Date or End of Migration Date'); return false; }
    if (mode==='po' && !form.poDate) { setError('Enter PO Received Date'); return false; }
    if (mode==='end' && !form.endMigrationDate) { setError('Enter End of Migration Date'); return false; }
    setError(''); return true;
  };

  const generateTimeline = () => {
    if (!validate()) return;
    let po, buildShip, install, endMigration;
    if (mode==='po'){
      po = parseDateLocal(form.poDate);
      buildShip = addDays(po, 21);
      install = addWeeks(buildShip, calcWeeks(form.s1022));
      install = addWeeks(install, calcWeeks(form.s1024));
      install = addWeeks(install, calcWeeks(form.e1050));
      install = addWeeks(install, calcWeeks(form.e1080));
      endMigration = addDays(install, 5 + Math.floor((form.lpars||0)/12));
    } else {
      endMigration = parseDateLocal(form.endMigrationDate);
      install = addDays(endMigration, -(5 + Math.floor((form.lpars||0)/12)));
      install = addWeeks(install, -calcWeeks(form.e1080));
      install = addWeeks(install, -calcWeeks(form.e1050));
      install = addWeeks(install, -calcWeeks(form.s1024));
      install = addWeeks(install, -calcWeeks(form.s1022));
      buildShip = addDays(install, -21);
      po = addDays(buildShip, -21);
    }
    setTimeline({ po, buildShip, install, endMigration });
    setStep(3);
  };

  // download PPT: pixel-perfect reproduction of screenshot, dynamic dates
  const downloadPPT = async () => {
    if (!timeline) return alert('Generate the timeline first.');

    const Pctor = window.PptxGenJS?.default || window.PptxGenJS;
    if (!Pctor) return alert('PptxGenJS library missing. Run locally.');

    // assemble base64 image
    const TIMELINE_BG_DATA = getTimelineBgData();

    if (!TIMELINE_BG_DATA) {
      // Fallback: try prompting user to paste base64 into console variable
      alert('Timeline background image missing. Please paste your base64 into the timeline-bg-json block in the page or upload the image.');
      return;
    }

    const pptx = new Pctor();
    const slide = pptx.addSlide();

    // white background
    slide.background = { color: 'FFFFFF' };

    // background image centered/size to match screenshot
    slide.addImage({ data: TIMELINE_BG_DATA, x:1.0, y:1.15, w:8.0, h:3.9 });

    // Title
    slide.addText('IBM Power Timeline', { x:0, y:0.35, w:10, fontSize:38, bold:true, align:'center' });

    // top labels
    slide.addText('Build / Ship', { x:3.9, y:1.05, w:2, fontSize:18, bold:true, color:'6A4FB3', align:'center' });
    slide.addText('You can edit the text for\\nthis timeline milestone.', { x:3.9, y:1.25, w:2, fontSize:11, color:'444444', align:'center' });

    slide.addText('End of Migration', { x:7.0, y:1.05, w:2, fontSize:18, bold:true, color:'C0392B', align:'center' });
    slide.addText('You can edit the text for\\nthis timeline milestone.', { x:7.0, y:1.25, w:2, fontSize:11, color:'444444', align:'center' });

    // center dates (dynamic)
    slide.addText(fmt(timeline.po), { x:1.0, y:2.20, w:2.4, fontSize:16, bold:true, color:'444444', align:'center' });
    slide.addText(fmt(timeline.buildShip), { x:3.0, y:2.20, w:2.4, fontSize:16, bold:true, color:'444444', align:'center' });
    slide.addText(fmt(timeline.install), { x:5.0, y:2.20, w:2.4, fontSize:16, bold:true, color:'444444', align:'center' });
    slide.addText(fmt(timeline.endMigration), { x:7.0, y:2.20, w:2.4, fontSize:16, bold:true, color:'444444', align:'center' });

    // bottom labels
    slide.addText('PO Received', { x:1.0, y:4.7, w:2.4, fontSize:16, bold:true, color:'E67E22', align:'center' });
    slide.addText('You can edit the text for\\nthis timeline milestone.', { x:1.0, y:4.95, w:2.4, fontSize:11, color:'444444', align:'center' });

    slide.addText('Installation', { x:5.0, y:4.7, w:2.4, fontSize:16, bold:true, color:'1BA2C1', align:'center' });
    slide.addText('You can edit the text for\\nthis timeline milestone.', { x:5.0, y:4.95, w:2.4, fontSize:11, color:'444444', align:'center' });

    await pptx.writeFile({ fileName: 'IBM_Power_Timeline.pptx' });
  };

  return (
    <div className="min-h-screen bg-gray-50 flex items-start justify-center p-8">
      <div className="w-full max-w-5xl bg-white shadow-2xl rounded-2xl overflow-hidden">
        <div className="bg-gradient-to-r from-blue-800 to-indigo-600 p-8 text-white">
          <h1 className="text-3xl font-extrabold">IBM Power — Timeline</h1>
        </div>

        <div className="p-8">
          {step === 1 && (
            <div className="space-y-6">
              {error && <p className="text-red-600">{error}</p>}

              <div className="flex space-x-6 items-center">
                <label className="flex items-center space-x-2">
                  <input type="radio" name="dateMode" checked={mode === 'po'} onChange={() => { setMode('po'); setForm(prev=>({...prev, endMigrationDate:''})); }} />
                  <span>PO Received Date</span>
                </label>
                <label className="flex items-center space-x-2">
                  <input type="radio" name="dateMode" checked={mode === 'end'} onChange={() => { setMode('end'); setForm(prev=>({...prev, poDate:''})); }} />
                  <span>End of Migration Date</span>
                </label>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {mode === 'po' && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700">PO Received Date</label>
                    <input name="poDate" type="date" value={form.poDate} onChange={handleChange} className="mt-2 w-full p-3 border rounded-lg" />
                  </div>
                )}

                {mode === 'end' && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700">End of Migration Date</label>
                    <input name="endMigrationDate" type="date" value={form.endMigrationDate} onChange={handleChange} className="mt-2 w-full p-3 border rounded-lg" />
                  </div>
                )}

                <div>
                  <label className="block text-sm font-medium text-gray-700"># S1022/1122 — <span className="font-bold text-indigo-600">{form.s1022}</span></label>
                  <input name="s1022" type="range" min="0" max="25" step="1" value={form.s1022} onChange={handleChange} className="mt-3 w-full" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700"># S1024/1124 — <span className="font-bold text-indigo-600">{form.s1024}</span></label>
                  <input name="s1024" type="range" min="0" max="25" step="1" value={form.s1024} onChange={handleChange} className="mt-3 w-full" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700"># E1050/1150 — <span className="font-bold text-indigo-600">{form.e1050}</span></label>
                  <input name="e1050" type="range" min="0" max="20" step="1" value={form.e1050} onChange={handleChange} className="mt-3 w-full" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700"># E1080/1180 — <span className="font-bold text-indigo-600">{form.e1080}</span></label>
                  <input name="e1080" type="range" min="0" max="10" step="1" value={form.e1080} onChange={handleChange} className="mt-3 w-full" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700">LPAR Count — <span className="font-bold text-indigo-600">{form.lpars}</span></label>
                  <input name="lpars" type="range" min="0" max="200" step="1" value={form.lpars} onChange={handleChange} className="mt-3 w-full" />
                </div>
              </div>

              <div className="flex justify-end">
                <button onClick={generateTimeline} className="px-6 py-2 bg-indigo-600 text-white rounded-md">Next</button>
              </div>
            </div>
          )}

          {step === 3 && timeline && (
            <div className="space-y-10">
              <h2 className="text-2xl font-semibold mb-10">Timeline Result</h2>

              <div className="relative w-full flex justify-between items-center px-6" style={{ marginTop: '80px' }}>
                <div className="absolute left-0 right-0 h-6 bg-gradient-to-r from-yellow-400 via-orange-400 via-purple-500 to-blue-900 rounded-full"></div>

                {[
                  { label: 'PO Received', date: fmt(timeline.po), color: 'bg-gradient-to-br from-yellow-300 to-yellow-500' },
                  { label: 'Build / Ship', date: fmt(timeline.buildShip), color: 'bg-gradient-to-br from-orange-300 to-orange-600' },
                  { label: 'Installation', date: fmt(timeline.install), color: 'bg-gradient-to-br from-purple-300 to-purple-600' },
                  { label: 'End of Migration', date: fmt(timeline.endMigration), color: 'bg-gradient-to-br from-blue-400 to-blue-900' }
                ].map((item, i) => (
                  <div key={i} className="relative z-10 flex flex-col items-center text-center" style={{ transform: 'translateY(-40px)' }}>
                    <div className="w-32 h-32 rounded-full bg-white shadow-xl flex items-center justify-center border-4 border-gray-200">
                      <div className={`w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-sm ${item.color}`}>
                        {item.date}
                      </div>
                    </div>
                    <p className="mt-4 text-gray-700 font-semibold text-sm">{item.label}</p>
                  </div>
                ))}
              </div>

              <div className="flex justify-between mt-10">
                <button onClick={() => setStep(1)} className="px-6 py-2 border rounded-md">Back</button>
                <div className="flex items-center space-x-3">
                  <button onClick={() => { setStep(1); setTimeline(null); }} className="px-6 py-2 border rounded-md">Start Over</button>
                  <button onClick={downloadPPT} className="px-6 py-2 bg-indigo-600 text-white rounded-md">Download PPT</button>
                </div>
              </div>
            </div>
          )}

        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<IBMWizard />);
</script>
</body>
</html>
