<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IBM Power Timeline — Pixel-Perfect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    html,body { height:100%; margin:0; font-family: "IBM Plex Sans", system-ui, -apple-system, sans-serif; background:#ffffff; color:#222; }
    .app { min-height:100%; display:flex; align-items:center; justify-content:center; padding:36px; box-sizing:border-box; }
    .card { width:100%; max-width:1100px; background:white; border-radius:14px; box-shadow:0 20px 50px rgba(13,18,25,0.12); overflow:hidden; }
    .header { background:linear-gradient(90deg,#0b3b80,#4b329c); padding:34px 40px; color:white; }
    .header h1 { margin:0; font-size:32px; font-weight:700; letter-spacing:0.2px; text-align:left; }
    .body { padding:40px; }
    /* Timeline preview styling (strictly visual) */
    .timeline-preview { width:100%; height:360px; display:flex; align-items:center; justify-content:center; position:relative; }
    .timeline-track { width:86%; height:8px; border-radius:8px; background:linear-gradient(90deg,#f2a53d,#a54aa6,#2b7fb8); position:absolute; top:50%; transform:translateY(-50%); box-shadow:inset 0 0 0 8px rgba(255,255,255,0.45); }
    .bubble { width:120px; height:120px; border-radius:50%; background:#fff; display:flex; align-items:center; justify-content:center; box-shadow:0 8px 18px rgba(0,0,0,0.15); border:6px solid rgba(0,0,0,0.04); position:absolute; transform:translateY(-54px); }
    .bubble .inner { width:86px; height:86px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; color:white; }
    .label-top { position:absolute; text-align:center; font-weight:700; font-size:15px; }
    .label-bottom { position:absolute; text-align:center; font-weight:700; color:#333; font-size:13px; margin-top:12px; }
    .small-note { position:absolute; text-align:center; font-size:11px; color:#666; white-space:pre-line; margin-top:4px; }
    .controls { padding:18px 0 0 0; display:flex; justify-content:flex-end; gap:12px; }
    button { cursor:pointer; border-radius:8px; padding:10px 14px; font-weight:600; border: none; }
    .btn-primary { background:#4c2fb2; color:white; }
    .btn-ghost { background:white; border:1px solid #ddd; color:#222; }
    .debug { font-family:monospace; font-size:12px; color:#a00; margin-top:8px; }
    /* layout positions approximating the screenshot */
    .pos-po { left:10%; }
    .pos-build { left:33%; }
    .pos-install { left:56%; }
    .pos-end { left:80%; }
    /* Hidden file area for base64 fallback */
    #timeline-bg-json { display:none; }
  </style>
  <!-- CDNs -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.11.0/dist/pptxgen.bundle.js"></script>
</head>
<body>
  <!-- Put your Base64 here in JSON form (multi-chunk safe). Leave as-is if you already have the FULL entry. -->
  <script id="timeline-bg-json" type="application/json">
    {"FULL":"{{BASE64_REPLACED_HERE}}"}
  </script>

  <div id="root" class="app"></div>

  <script type="text/babel">
    const { useState } = React;

    const getBase64 = () => {
      try {
        const el = document.getElementById('timeline-bg-json');
        if(!el) return null;
        const json = JSON.parse(el.textContent || '{}');
        if(json.FULL && json.FULL.length>50) return 'data:image/png;base64,' + json.FULL;
        // support chunked keys (PART1..PART5)
        const parts = [];
        for(let i=1;i<=10;i++){
          const k = 'PART'+i;
          if(json[k]) parts.push(json[k]);
        }
        if(parts.length) return 'data:image/png;base64,' + parts.join('');
        return null;
      } catch(e){
        console.error('bg read error', e);
        return null;
      }
    };

    function App(){
      const [poDate,setPoDate] = useState('');
      const [endDate,setEndDate] = useState('');
      const [timeline,setTimeline] = useState(null);
      const [err,setErr] = useState('');

      const compute = (mode) => {
        if(mode==='po' && !poDate){ setErr('Enter PO date'); return; }
        if(mode==='end' && !endDate){ setErr('Enter End date'); return; }
        setErr('');
        const parse = s => s ? new Date(s+'T00:00:00') : null;
        let po, build, install, end;
        if(mode==='po'){
          po = parse(poDate);
          build = new Date(po); build.setDate(build.getDate()+21);
          install = new Date(build); install.setDate(install.getDate()+14);
          end = new Date(install); end.setDate(end.getDate()+10);
        } else {
          end = parse(endDate);
          install = new Date(end); install.setDate(install.getDate()-10);
          build = new Date(install); build.setDate(build.getDate()-14);
          po = new Date(build); po.setDate(po.getDate()-21);
        }
        setTimeline({po,build,install,end});
      };

      const downloadPPT = async () => {
        if(!timeline){ alert('Generate timeline first'); return; }
        const P = window.PptxGenJS?.default || window.PptxGenJS;
        if(!P){ alert('pptxgenjs missing'); return; }
        const bg = getBase64();
        if(!bg){ alert('Background image missing in timeline-bg-json. Paste the Base64 into the JSON block.'); return; }

        const pptx = new P();
        const slide = pptx.addSlide();
        slide.background = { color:'FFFFFF' };

        // Add background PNG centered (scale to width leave top whitespace to match screenshot)
        slide.addImage({ data: bg, x:0.6, y:0.8, w:9.0, h:5.1 });

        // Title (match screenshot)
        slide.addText('IBM Power Timeline', { x:0.5, y:0.2, w:9, fontSize:40, bold:true, align:'center', fontFace:'IBM Plex Sans' });

        // Date text positions that match the image layout (these are tuned values)
        slide.addText(formatDate(timeline.po), { x:1.2, y:2.6, w:1.6, fontSize:14, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'444444' });
        slide.addText(formatDate(timeline.build), { x:3.2, y:2.6, w:1.6, fontSize:14, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'444444' });
        slide.addText(formatDate(timeline.install), { x:5.0, y:2.6, w:1.6, fontSize:14, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'444444' });
        slide.addText(formatDate(timeline.end), { x:6.8, y:2.6, w:1.6, fontSize:14, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'444444' });

        // Bottom labels
        slide.addText('PO Received', { x:1.0, y:4.6, w:1.8, fontSize:13, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'E67E22' });
        slide.addText('Installation', { x:4.6, y:4.6, w:2.0, fontSize:13, bold:true, fontFace:'IBM Plex Sans', align:'center', color:'1BA2C1' });

        await pptx.writeFile({ fileName:'IBM_Power_Timeline_PerfectMatch.pptx' });
      };

      const formatDate = (d) => {
        if(!d) return '';
        return d.toLocaleDateString();
      };

      return (
        <div className="card">
          <div className="header">
            <h1>IBM Power — Timeline</h1>
          </div>

          <div className="body">
            <div style={{ display:'flex', gap:24, alignItems:'flex-start' }}>
              <div style={{ flex:1 }}>
                <div style={{ marginBottom:10 }}>
                  <strong>Enter Dates</strong>
                </div>

                <div style={{ display:'flex', gap:8, marginBottom:8 }}>
                  <input type="date" value={poDate} onChange={e=>setPoDate(e.target.value)} style={{ padding:8, borderRadius:6, border:'1px solid #ddd', flex:1 }} />
                  <button className="btn-ghost" onClick={()=>compute('po')}>Compute from PO</button>
                </div>

                <div style={{ display:'flex', gap:8 }}>
                  <input type="date" value={endDate} onChange={e=>setEndDate(e.target.value)} style={{ padding:8, borderRadius:6, border:'1px solid #ddd', flex:1 }} />
                  <button className="btn-ghost" onClick={()=>compute('end')}>Compute from End</button>
                </div>

                <div style={{ marginTop:12, display:'flex', gap:8 }}>
                  <button className="btn-primary" onClick={downloadPPT}>Download PPT (Perfect-Match)</button>
                  <button className="btn-ghost" onClick={()=>{ location.reload(); }}>Reload</button>
                </div>

                {err && <div className="debug">{err}</div>}

                {timeline && (
                  <div style={{ marginTop:14 }}>
                    <div>PO: <b>{formatDate(timeline.po)}</b></div>
                    <div>Build / Ship: <b>{formatDate(timeline.build)}</b></div>
                    <div>Installation: <b>{formatDate(timeline.install)}</b></div>
                    <div>End: <b>{formatDate(timeline.end)}</b></div>
                  </div>
                )}

                <div style={{ marginTop:14, fontSize:12, color:'#666' }}>
                  Tip: if the PPT text looks slightly different, install "IBM Plex Sans" locally. The exported PPT uses that font name; PowerPoint will fallback when not available.
                </div>
              </div>

              <div style={{ width:520 }}>
                <div className="timeline-preview" aria-hidden>
                  <div className="timeline-track"></div>
                  <div className="bubble pos-po" style={{ top:'34%', left:'10%' }}>
                    <div className="inner" style={{ background:'linear-gradient(180deg,#f6a426,#df7b2f)' }}>12/3/2025</div>
                  </div>
                  <div className="bubble pos-build" style={{ top:'34%', left:'33%' }}>
                    <div className="inner" style={{ background:'linear-gradient(180deg,#b46ac3,#7d4aa8)' }}>12/24/2025</div>
                  </div>
                  <div className="bubble pos-install" style={{ top:'34%', left:'56%' }}>
                    <div className="inner" style={{ background:'linear-gradient(180deg,#4ec3d0,#1b9fb2)' }}>1/7/2026</div>
                  </div>
                  <div className="bubble pos-end" style={{ top:'34%', left:'80%' }}>
                    <div className="inner" style={{ background:'linear-gradient(180deg,#4b77b3,#17365f)' }}>1/23/2026</div>
                  </div>

                  <div className="label-top" style={{ top:'6%', left:'30%', width:180 }}>Build / Ship<br/><span style={{ fontSize:12, fontWeight:400, color:'#666' }}>You can edit the text for this timeline milestone.</span></div>
                  <div className="label-top" style={{ top:'6%', left:'68%', width:180 }}>End of Migration<br/><span style={{ fontSize:12, fontWeight:400, color:'#666' }}>You can edit the text for this timeline milestone.</span></div>

                  <div className="label-bottom" style={{ top:'74%', left:'8%', width:200 }}>PO Received</div>
                  <div className="label-bottom" style={{ top:'74%', left:'52%', width:200 }}>Installation</div>

                </div>
              </div>
            </div>

            <div style={{ marginTop:16, fontSize:12, color:'#666' }}>
              Debug: open developer console for runtime errors. If the PNG is not shown in the exported PPT, paste the base64 into the JSON block at the top.
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
