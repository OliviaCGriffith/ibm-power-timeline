const downloadPPT = async () => {
    if (!timeline) return alert("Generate the timeline first.");

    const Pctor = window.PptxGenJS?.default || window.PptxGenJS;
    if (!Pctor) return alert("PPT library missing. Run locally.");

    // Check if base64 image is provided
    if (!timelineImageBase64) {
      alert("Please paste your base64 image string in the code first!\n\nInstructions:\n1. Go to https://base64.guru/converter/encode/image\n2. Upload your Slide1.png\n3. Copy the base64 string (WITHOUT the 'data:image/png;base64,' prefix)\n4. Paste it into the timelineImageBase64 variable in the code");
      return;
    }

    const pptx = new Pctor();
    const slide = pptx.addSlide();

    // Set white background
    slide.background = { color: "FFFFFF" };

    // Add the base timeline image from base64
    slide.addImage({
      data: `image/png;base64,${timelineImageBase64}`,
      x: 1.25,
      y: 1.3,
      w: 7.5,
      h: 4.5
    });

    // Overlay the dynamic dates on top of the image
    // These positions are calibrated to match where the date placeholders appear in your PNG
    
    // [DATE OF PO RECEIVED] - Position: upper left
    slide.addText(fmt(timeline.po), {
      x: 1.5, y: 2.85, w: 1.8, 
      fontSize: 14, bold: true, color: "000000", align: "center"
    });

    // [DATE OF BUILD / SHIP] - Position: lower middle-left
    slide.addText(fmt(timeline.buildShip), {
      x: 3.5, y: 4.2, w: 2.0, 
      fontSize: 14, bold: true, color: "000000", align: "center"
    });

    // [DATE OF INSTALLATION] - Position: upper middle-right
    slide.addText(fmt(timeline.install), {
      x: 5.6, y: 2.85, w: 1.9, 
      fontSize: 14, bold: true, color: "000000", align: "center"
    });

    // [DATE OF END OF MIGRATION] - Position: lower right
    slide.addText(fmt(timeline.endMigration), {
      x: 7.2, y: 4.2, w: 2.2, 
      fontSize: 14, bold: true, color: "000000", align: "center"
    });

    try {
      await pptx.writeFile({ fileName: "IBM_Power_Timeline.pptx" });
      alert("PPT downloaded successfully!");
    } catch (err) {
      console.error(err);
      alert("Failed to generate PPT: " + err.message);
    }
  };
